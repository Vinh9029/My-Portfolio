// SIGN OUT / LOGOUT FLOW FIX

console.log(`
âœ… LOGOUT SECURITY FIX APPLIED
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

PROBLEM:
  Button "Sign Out" trong admin dashboard khÃ´ng hoáº¡t Ä‘á»™ng
  NÃ³ chá»‰ redirect vá» home page (/) mÃ  khÃ´ng clear session
  User cÃ³ thá»ƒ quay láº¡i /admin mÃ  khÃ´ng cáº§n login láº¡i

SOLUTION:
  1. Import signOut tá»« 'next-auth/react'
  2. Gá»i signOut({ redirect: false })
  3. Show toast success message
  4. Redirect vá» /login (khÃ´ng /)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

CODE CHANGES:

ğŸ“ app/admin/page.tsx

1. Import signOut:
   âœ… import { useSession, signOut } from 'next-auth/react';

2. Update Sign Out button:
   OLD:
   â””â”€ onClick={() => router.push('/')}
      (KhÃ´ng clear session!)
   
   NEW:
   â””â”€ onClick={async () => {
        await signOut({ redirect: false });
        toast.success('Signed out successfully!', 2000);
        setTimeout(() => router.push('/login'), 1000);
      }}
      (Properly clear session + redirect)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

LOGOUT FLOW:

1. User clicks "Sign Out" button
   â†“
2. signOut({ redirect: false })
   â”œâ”€ Clears NextAuth session
   â”œâ”€ Removes JWT token
   â”œâ”€ Removes httpOnly cookie
   â””â”€ Does NOT redirect (redirect: false)
   â†“
3. Show toast: "Signed out successfully!"
   â†“
4. After 1 second, redirect to /login
   â†“
5. Session is gone - /admin will now redirect to /login

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

SECURITY GUARANTEE:

âœ… signOut() completely clears session
âœ… JWT token is invalidated
âœ… httpOnly cookie is deleted
âœ… Cannot fake session (server-signed)
âœ… User must login again for /admin

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

WHY redirect: false?

By default, signOut() redirects to signIn page
But we want to:
1. Show custom toast message first
2. Have control over where to redirect
3. Prevent immediate redirect

Solution: signOut({ redirect: false })
Then manually redirect with router.push()

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

COMPLETE LOGIN/LOGOUT CYCLE:

1. User visits /login (not authenticated)
   â”œâ”€ Page shows login form
   â””â”€ useSession() returns status='unauthenticated'

2. User enters credentials + clicks Login
   â”œâ”€ handleCredentialsLogin() called
   â”œâ”€ signIn('credentials', {...}) â†’ creates session
   â”œâ”€ updateSession() â†’ refreshes session state
   â”œâ”€ Toast: "Login successful!"
   â””â”€ Redirect to /admin after 1.5s

3. User sees admin dashboard
   â”œâ”€ /admin page loads
   â”œâ”€ useSession() returns status='authenticated'
   â”œâ”€ Dashboard renders âœ…
   â””â”€ Session cookie is valid

4. User clicks "Sign Out"
   â”œâ”€ signOut({ redirect: false }) â†’ clears session
   â”œâ”€ Toast: "Signed out successfully!"
   â”œâ”€ Redirect to /login after 1s
   â””â”€ Session cookie is destroyed

5. User tries to visit /admin again
   â”œâ”€ useSession() returns status='unauthenticated'
   â”œâ”€ useEffect redirects to /login
   â””â”€ Loop back to step 1

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

SESSION LIFECYCLE:

[Login]
  â†“
JWT Token Created + httpOnly Cookie Set
  â†“
User can access /admin (authenticated)
  â†“
Token expires in 30 days (or manually signOut)
  â†“
[Sign Out]
  â†“
Session cleared, token invalidated
  â†“
User cannot access /admin (must login again)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

FILES CHANGED:

âœ… app/admin/page.tsx
   â”œâ”€ Added: import signOut
   â””â”€ Updated: Sign Out button handler

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

TESTING CHECKLIST:

Test 1: Normal Logout
âœ“ Login successfully
âœ“ Click "Sign Out" button
âœ“ Expect: Toast "Signed out successfully!"
âœ“ Redirect to /login page
âœ“ Try /admin again â†’ redirects to /login (not accessible)

Test 2: Session Persistence
âœ“ Login â†’ /admin
âœ“ Close browser (keep cookies)
âœ“ Reopen and visit /admin
âœ“ Still authenticated (session valid for 30 days)

Test 3: Session Expiration
âœ“ Login â†’ get session cookie
âœ“ Wait 30 days OR manually delete cookie
âœ“ Try /admin
âœ“ Session expired â†’ redirect /login

Test 4: Direct /login Visit After Login
âœ“ Already logged in
âœ“ Visit /login page
âœ“ Should show login form (or redirect?)
âœ“ Can still access /admin

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

NEXTAUTH FLOW:

signOut() internally:
1. Removes JWT token from memory
2. Removes httpOnly cookie from browser
3. Calls session callback with null
4. Clears session data

Cannot be bypassed because:
â”œâ”€ JWT is server-signed
â”œâ”€ Cookie is httpOnly (JS cannot access)
â”œâ”€ Next request requires valid token
â””â”€ Invalid/missing token = unauthenticated

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

BUTTON BEHAVIOR:

Before Fix:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         [Sign Out Button]        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
    Click event
         â†“
  router.push('/') 
         â†“
  Redirects to home
         â†“
  âš ï¸ Session STILL valid!
     User can go back to /admin
         â†“
  SECURITY ISSUE âŒ

After Fix:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         [Sign Out Button]        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
    Click event
         â†“
  1. signOut({ redirect: false })
  2. Toast: "Signed out successfully!"
  3. setTimeout(() => router.push('/login'), 1000)
         â†“
  Session DESTROYED âœ…
  Redirect to /login
         â†“
  User cannot access /admin
     (must login again)
         â†“
  SECURE âœ…

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

RELATED FILES:

- app/api/auth/[...nextauth]/route.ts â†’ NextAuth config
- app/login/page.tsx â†’ Login page (uses signIn)
- app/admin/page.tsx â†’ Admin dashboard (uses signOut)
- app/providers.tsx â†’ SessionProvider wrapper

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

READY FOR TESTING

All changes applied âœ…
No TypeScript errors âœ…
Just restart dev server: npm run dev
Then test the logout flow

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
`);
